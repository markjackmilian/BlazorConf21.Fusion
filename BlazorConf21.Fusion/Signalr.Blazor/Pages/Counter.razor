@page "/counter"
@using Microsoft.AspNetCore.SignalR.Client
@using Signalr.Blazor.Data
@inject NavigationManager NavigationManager
@inject CounterService CounterService

<h1>Counter</h1>

<p>Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;
   
    private async Task IncrementCount()
    {
        await this.CounterService.AddOne();
    }
    

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var hubConnection = new HubConnectionBuilder()
                .WithUrl("https://localhost:5001/counter")
                // .WithAutomaticReconnect()
                .Build();
            //
            hubConnection.On<int>("IncrementCount", ( message) =>
            {
                this.currentCount = message;
                StateHasChanged();
            });
            //
            await hubConnection.StartAsync();

            this.currentCount = this.CounterService.GetCount();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
      
    }

}